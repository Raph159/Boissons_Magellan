services:
  proxy:
    image: nginx:alpine
    container_name: boissons-proxy
    ports:
      - "80:80"
    volumes:
      - ./ops/nginx/nginx.conf:/etc/nginx/conf.d/default.conf:ro
    depends_on:
      - kiosk
      - admin
      - backend
    restart: unless-stopped

  backend:
    build: ./backend
    container_name: boissons-backend
    environment:
      DB_PATH: /data/app.db
      PORT: "3000"
      NODE_ENV: production
    volumes:
      - /var/lib/boissons:/data
    restart: unless-stopped

  kiosk:
    build: ./kiosk
    container_name: boissons-kiosk
    restart: unless-stopped

  admin:
    build: ./admin
    container_name: boissons-admin
    restart: unless-stopped

  backup:
    build: ./ops/backup
    container_name: boissons-backup
    volumes:
      - /var/lib/boissons:/data
      - /var/backups/boissons:/backups
    environment:
      DB_PATH: /data/app.db
      BACKUP_ROOT: /backups
    restart: unless-stopped